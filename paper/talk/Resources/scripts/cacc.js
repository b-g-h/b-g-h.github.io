!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.cacc=e():t.cacc=e()}(this,(function(){return(()=>{"use strict";var t={422:(t,e)=>{function n(t){return e.prefix_+"-"+t}Object.defineProperty(e,"__esModule",{value:!0}),e.hasSpeech=e.getDocument=e.children=e.classList=e.getAttribute=e.getTextContent=e.toggleExpertMode=e.EXPERT_MODE=e.toArray=e.getId=e.idCounter_=e.addPrefix=e.prefix_=void 0,e.prefix_="cacc",e.addPrefix=n,e.idCounter_=0,e.getId=function(){return n("Id-"+e.idCounter_++)},e.toArray=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n]);return e},e.EXPERT_MODE=!1,e.toggleExpertMode=function(){e.EXPERT_MODE=!e.EXPERT_MODE},e.getTextContent=function(t){var e=t.textContent;return" "!==e&&(e=e.replace(/^\s*/,"")),e},e.getAttribute=function(t,e){return t.getAttribute(e)||t.getAttributeNS("http://www.chemaccess.org/sre-schema",e)||t.getAttribute("sre:"+e)},function(t){function e(t,e){t.classList&&t.classList.add?t.classList.add(e):t.className?o(t.className)?t.className.baseVal+=" "+e:t.className+=" "+e:t.className=e}function n(t,e){if(t.classList&&t.classList.remove&&t.classList.remove(e),t.className){var n=t.className;o(n)?n.baseVal=n.baseVal.replace(" "+e,""):t.className=t.className.replace(" "+e,"")}}function o(t){return"string"!=typeof t}t.add=e,t.remove=n,t.toggle=function(t,r){t.classList&&t.classList.toggle?t.classList.toggle(r):t.className?!function(t,e){return-1!==(o(t)?t.baseVal:t).search(e)}(t.className,r)?e(t,r):n(t,r):t.className=r}}(e.classList||(e.classList={})),e.children=function(t){if(t.children)return Array.prototype.slice.call(t.children);for(var e=[],n=t.childNodes,o=0,r=void 0;r=n[o];o++)1===r.nodeType&&e.push(r);return e},e.getDocument=function(){var t;return(null===(t=null===window||void 0===window?void 0:window.top)||void 0===t?void 0:t.document)||document},e.hasSpeech=function(){return!("undefined"==typeof speechSynthesis)}},911:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.replaceStyle_=e.removeStyle_=e.addStyle_=e.svgForegroundStyle_=e.svgBackgroundStyle_=e.svgHighlightStyle_=e.regionStyle_=e.svgBaseStyle_=e.nodeBackgroundStyle_=e.pickScheme=e.moleculeStyle=e.getScheme_=e.colorSchemes_=e.toggleMonochrome=e.toggleTextVisibility=e.documentCmlStyle=void 0;var o=n(422);function r(t){return e.colorSchemes_[t%e.colorSchemes_.length]}function i(t,e){var n=r(e);u(t,n.bkd),a(t.node,n.bkd),l(t,n.frgd),s(t,n.active,n.almost)}function a(t,e){t.style.backgroundColor=e}function c(t){var e="svg."+t.id,n="";n+=e+" { overflow: hidden; }",n+=e+" text { font-size: 16px; font-family: serif; }",n+=e+" text tspan[baseline-shift] { font-weight: 200; font-size: 13px; }",n+=e+" line, svg rect { stroke-width: 1.0;  stroke-linecap: round; }",n+=e+" line.cacc-active, svg g.cacc-active line { stroke-width: 3.0; }",n+=e+" line.cacc-almost, svg g.cacc-almost line { stroke-width: 2.0; }",n+=e+" g.cacc-active text { font-weight: bold; }",n+=e+" g#gridSVG g.cacc-active text { font-weight: bold; }",n+="ul.cacc-controls { list-style-type: none; }",n+=e+" polyline.cacc-active, svg g.cacc-active polyline { stroke-width: 3.0; }",n+=e+" polyline.cacc-almost, svg g.cacc-almost polyline { stroke-width: 2.0; }",n+=e+" polygon.cacc-active, svg g.cacc-active polygon { stroke-width: 3.0; }",n+=e+" polygon.cacc-almost, svg g.cacc-almost polygon { stroke-width: 2.0; }",n+=e+" path.cacc-active, svg g.cacc-active path { stroke-width: 3.0; }",n+=e+" path.cacc-almost, svg g.cacc-almost path { stroke-width: 2.0; }",n+=e+" rect.cacc-active, svg g.cacc-active rect { stroke-width: 3.0; }",n+=e+" rect.cacc-almost, svg g.cacc-almost rect { stroke-width: 2.0; }",n+=e+" circle.cacc-active, svg g.cacc-active circle { stroke-width: 3.0; }",n+=e+" circle.cacc-almost, svg g.cacc-almost circle { stroke-width: 2.0; }",p(t.node,n,"cacc-base")}function s(t,e,n){var o="svg."+t.id,r="";r+=o+" line.cacc-active, g.cacc-active line { stroke: "+e+"; }",r+=o+" line.cacc-almost, g.cacc-almost line { stroke: "+n+"; }",r+=o+" g.cacc-active text { fill: "+e+"; }",r+=o+" g.cacc-almost text { fill: "+n+"; }",r+=o+" g#gridSVG g.cacc-active text { fill: "+e+"; }",r+=o+" g#gridSVG g.cacc-almost text { fill: "+n+"; }",r+=o+" polyline.cacc-active, g.cacc-active polyline { stroke: "+e+"; }",r+=o+" polyline.cacc-almost, g.cacc-almost polyline { stroke: "+n+"; }",r+=o+" polygon.cacc-active, g.cacc-active polygon { stroke: "+e+"; }",r+=o+" polygon.cacc-almost, g.cacc-almost polygon { stroke: "+n+"; }",r+=o+" path.cacc-active, g.cacc-active path { stroke: "+e+"; }",r+=o+" path.cacc-almost, g.cacc-almost path { stroke: "+n+"; }",r+=o+" rect.cacc-active, g.cacc-active rect { stroke: "+e+"; }",r+=o+" rect.cacc-almost, g.cacc-almost rect { stroke: "+n+"; }",r+=o+" circle.cacc-active, g.cacc-active circle { stroke: "+e+"; }",r+=o+" circle.cacc-almost, g.cacc-almost circle { stroke: "+n+"; }",f(t.node,r,"cacc-color-highlight")}function u(t,e){var n="svg."+t.id,o="";o+=n+" { background-color: "+e+"; }",o+=n+" g.atom rect { stroke: "+e+"; fill: "+e+"; }",o+="div.container { background-color: "+e+"; }",o+="p."+t.id+".cacc-message { background-color: "+e+"; }",o+="p."+t.id+".cacc-message.cacc-text-invisible { color: "+e+"; }",f(t.node,o,"cacc-color-background")}function l(t,e){var n="svg."+t.id,o="";o+=n+" line { stroke: "+e+"; fill: "+e+"; }",o+=n+".cacc-text-monochrome text",o+=" { stroke: "+e+"; fill: "+e+"; }",o+=n+" g#gridSVG text { stroke: "+e+"; fill: "+e+"; }",o+="div.container { color: "+e+"; }",o+="p."+t.id+".cacc-message { color: "+e+"; }",o+="ul."+t.id+".cacc-controls { color: "+e+"; }",o+=n+" polyline { stroke: "+e+"; fill: "+e+"; }",o+=n+" polygon { stroke: "+e+"; fill: "+e+"; }",o+=n+" path { stroke: "+e+"; fill: "+e+"; }",o+=n+" rect { stroke: "+e+"; fill: "+e+"; }",o+=n+" circle { stroke: "+e+"; fill: "+e+"; }",f(t.node,o,"cacc-color-elements")}function p(t,e,n){var o=document.createElement("style");o.setAttribute("class",n),o.innerHTML=e,t.appendChild(o)}function h(t,e){var n=t.querySelector("style."+e);return!!n&&(t.removeChild(n),!0)}function f(t,e,n){h(t,n),p(t,e,n)}e.documentCmlStyle=function(){document.body&&p(document.body,"div.cml { display:none; }","cacc-cml")},e.toggleTextVisibility=function(t){o.classList.toggle(t,"cacc-text-invisible")},e.toggleMonochrome=function(t){o.classList.toggle(t,"cacc-text-monochrome")},e.colorSchemes_=[{frgd:"#000",bkd:"#fff",active:"#fd6",almost:"#6df"},{frgd:"#fff",bkd:"#000",active:"#fd6",almost:"#6df"},{frgd:"#3C3",bkd:"#000",active:"#fd6",almost:"#6df"},{frgd:"#ee0",bkd:"#00e",active:"#4f4",almost:"#e3e"}],e.getScheme_=r,e.moleculeStyle=function(t){c(t),i(t,0)},e.pickScheme=i,e.nodeBackgroundStyle_=a,e.svgBaseStyle_=c,e.regionStyle_=function(t){p(t,"p.cacc-message.cacc-text-invisible { font-size: 0px; }","cacc-base")},e.svgHighlightStyle_=s,e.svgBackgroundStyle_=u,e.svgForegroundStyle_=l,e.addStyle_=p,e.removeStyle_=h,e.replaceStyle_=f},446:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.CustomEvent=e.EventType=e.KeyCodes=void 0,function(t){t[t.RETURN=13]="RETURN",t[t.ENTER=13]="ENTER",t[t.ESC=27]="ESC",t[t.SPACE=32]="SPACE",t[t.LEFT=37]="LEFT",t[t.UP=38]="UP",t[t.RIGHT=39]="RIGHT",t[t.DOWN=40]="DOWN",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.COMMA=188]="COMMA",t[t.PERIOD=190]="PERIOD"}(e.KeyCodes||(e.KeyCodes={})),function(t){t.CLICK="click",t.DBLCLICK="dblclick",t.MOUSEDOWN="mousedown",t.MOUSEUP="mouseup",t.MOUSEOVER="mouseover",t.MOUSEOUT="mouseout",t.MOUSEMOVE="mousemove",t.SELECTSTART="selectstart",t.KEYPRESS="keypress",t.KEYDOWN="keydown",t.KEYUP="keyup",t.TOUCHSTART="touchstart",t.TOUCHMOVE="touchmove",t.TOUCHEND="touchend",t.TOUCHCANCEL="touchcancel"}(e.EventType||(e.EventType={}));var n=function(){function t(t,e,n){this.src=t,this.type=e,this.callback=n,this.src=t,this.type=e,this.callback=n}return t.prototype.add=function(){this.src.addEventListener(this.type,this.callback)},t.prototype.remove=function(){this.src.removeEventListener(this.type,this.callback)},t}();e.CustomEvent=n},807:(t,e)=>{var n,o,r,i,a,c;Object.defineProperty(e,"__esModule",{value:!0}),e.config=e.options=e.sound=e.speech=e.colors=e.regions=e.magnifiers=e.explorers=e.version=void 0,e.version="0.9.9",function(t){t.KEY="key",t.MENU="menu"}(n=e.explorers||(e.explorers={})),function(t){t.DUMMY="dummy",t.STEP="step",t.SIMPLE="simple"}(o=e.magnifiers||(e.magnifiers={})),function(t){t.SUBTITLE="subtitle",t.SPEECH="speech"}(r=e.regions||(e.regions={})),function(t){t.MONOCHROME="monochrome",t.CONTRAST="contrast"}(i=e.colors||(e.colors={})),function(t){t.LANGUAGE="language",t.EXPERT="expert"}(a=e.speech||(e.speech={})),function(t){t.OSCILLATOR="oscillator",t.VOICING="voicing"}(c=e.sound||(e.sound={})),e.options={explorers:[n.KEY,n.MENU],magnifiers:[o.STEP,o.SIMPLE,o.DUMMY],regions:[r.SUBTITLE,r.SPEECH],colors:[i.MONOCHROME,i.CONTRAST],speech:[a.LANGUAGE,a.EXPERT],sound:[c.OSCILLATOR,c.VOICING]},e.config={MSG_VISIBLE:!0,MAG_ACTIVE:o.STEP,SONIFY:!1,VOICING:!0,VOICE_LANG:"en",ACTIVE_LANG:"en",SUB_VISIBLE:!1,SUBTITLE:null}},23:function(t,e,n){var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a};Object.defineProperty(e,"__esModule",{value:!0}),e.Base=void 0;var i=n(966),a=n(422),c=n(911),s=n(807),u=n(402);!function(t){t.molMap={},t.init=function(){var e,n,l=u.forDocument();Object.keys(l).length>0&&(c.documentCmlStyle(),s.config.SUBTITLE=function(){var t=a.getDocument(),e=t.createElement("p");e.classList.add("explorer"),e.classList.add("cacc-message");var n=c.getScheme_(1);e.style.cssText+="position:fixed;left:0;bottom:0;background-color: "+n.bkd+"; color: "+n.frgd,c.regionStyle_(t.body),s.config.SUB_VISIBLE||e.classList.add("cacc-text-invisible");return e}());try{for(var p=o(Object.entries(l)),h=p.next();!h.done;h=p.next()){var f=r(h.value,2),d=f[0],g=f[1];t.molMap[d]=new i.Container(d,g)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(n=p.return)&&n.call(p)}finally{if(e)throw e.error}}}}(e.Base||(e.Base={}))},402:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.fromUri_=e.getUrlParameters_=e.getParam_=e.getData_=e.getMol_=e.forDocument=void 0;var o=n(29);function r(t){t.querySelector("div.svg")?(t.setAttribute("has-svg","true"),o.rewriteTransformations(t.querySelector("div.svg > svg"))):i(t,"svg","data-src",".svg"),t.querySelector("div.cml")?t.setAttribute("has-cml","true"):i(t,"cml","data-cml",".xml")}function i(t,e,n,r){var i=t.getAttribute(n)||a(t,n,r);i?s(i,(function(n){if(n){t.setAttribute("has-"+e,"true");var r=document.createElement("div");r.classList.add(e),"svg"===e&&o.rewriteTransformations(n),r.appendChild(n.documentElement),t.appendChild(r)}else t.setAttribute("has-"+e,"false")})):t.setAttribute("has-"+e,"false")}function a(t,e,n){if(!t.id)return null;var o=c()[t.id];return o?(o+=n,t.setAttribute(e,o),o):null}function c(){for(var t,e={},n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)e[(t=n[o].split("="))[0]]=t[1];return e}function s(t,e){if("file:"===location.protocol)return console.log(location),void e(null);var n=new DOMParser,o=new XMLHttpRequest;o.onreadystatechange=function(){4===o.readyState&&200===o.status&&e(n.parseFromString(o.responseText,"text/xml"))},o.open("GET",t,!0),o.send(null)}e.forDocument=function(t){for(var e=t||document,n=Array.from(e.querySelectorAll("div.ChemAccess-element")),o={},i=0,a=void 0;a=n[i];i++)r(a),a.id||(a.id="ChemAccess-element"+i),o[a.id]=a;return o},e.getMol_=r,e.getData_=i,e.getParam_=a,e.getUrlParameters_=c,e.fromUri_=s},29:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.transformNodes=e.purgeTransforms=e.envelopNode=e.transformNode=e.rewriteTransformations=void 0;var o=n(422);function r(t){var e=t,n=[];do{var o=e.getAttribute("transform");o&&n.unshift(o),e=e.parentNode}while("svg"!==e.tagName);return t.setAttribute("transform",n.join(" ")),t}function i(t){var e=document.createElementNS("http://www.w3.org/2000/svg","g"),n=t.getAttribute("id");return n&&(e.setAttribute("id",n),t.removeAttribute("id")),t.parentNode.replaceChild(e,t),e.appendChild(t),e}function a(t){var e=t;do{(e=e.parentNode).removeAttribute("transform")}while("svg"!==e.tagName)}function c(t){t.forEach(r),t.forEach(a),t.filter((function(t){return t.hasAttribute("id")})).forEach(i)}e.rewriteTransformations=function(t){var e=o.toArray(t.querySelectorAll("text,polyline,line,rect,polygon,use,path"));return c(e),e},e.transformNode=r,e.envelopNode=i,e.purgeTransforms=a,e.transformNodes=c},113:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Contrast=e.Monochrome=e.AbstractColor=void 0;var i=n(911),a=n(446),c=n(807),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(){},e}(n(530).AbstractController);e.AbstractColor=s;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.colors.MONOCHROME,e}return r(e,t),e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,a.EventType.KEYDOWN,(function(e){return e.keyCode===a.KeyCodes.T&&i.toggleMonochrome(t.container.molecule.svg),e.stopPropagation(),!1}))},e}(s);e.Monochrome=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.colors.CONTRAST,e.scheme=0,e}return r(e,t),e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,a.EventType.KEYDOWN,(function(e){return e.keyCode===a.KeyCodes.C&&i.pickScheme(t.container.molecule,++t.scheme),e.stopPropagation(),!1}))},e}(s);e.Contrast=l},530:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.AbstractController=void 0;var o=n(446),r=function(){function t(t){this.container=t,this._active=!1,this.internalEvents_=[],this.customEvents()}return Object.defineProperty(t.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t},enumerable:!1,configurable:!0}),t.prototype.activate=function(){this.active=!0,this.addEvents()},t.prototype.deactivate=function(){this.removeEvents(),this.active=!1},t.prototype.registerEvent=function(t,e,n){this.internalEvents_.push(new o.CustomEvent(t,e,n))},t.prototype.addEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.add()},t.prototype.removeEvents=function(){for(var t,e=0;t=this.internalEvents_[e];e++)t.remove()},t}();e.AbstractController=r},889:function(t,e,n){var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.ControllerFactory=void 0;var r=n(807),i=n(113),a=n(172),c=n(10),s=n(556),u=n(150),l=n(916);!function(t){var e,n=((e={})[r.magnifiers.SIMPLE]=function(t){return new c.SimpleMagnifier(t)},e[r.magnifiers.STEP]=function(t){return new c.StepMagnifier(t)},e[r.magnifiers.DUMMY]=function(t){return new c.DummyMagnifier(t)},e[r.colors.MONOCHROME]=function(t){return new i.Monochrome(t)},e[r.colors.CONTRAST]=function(t){return new i.Contrast(t)},e[r.speech.EXPERT]=function(t){return new l.Expert(t)},e[r.speech.LANGUAGE]=function(t){return new l.Language(t)},e[r.regions.SPEECH]=function(t){return new s.Speech(t)},e[r.regions.SUBTITLE]=function(t){return new s.Subtitle(t)},e[r.explorers.KEY]=function(t){return new a.KeyExplorer(t)},e[r.explorers.MENU]=function(t){return new a.MenuExplorer(t)},e[r.sound.OSCILLATOR]=function(t){return new u.Oscillator(t)},e[r.sound.VOICING]=function(t){return new u.Voicing(t)},e);t.get=function(t){var e,i,a=[],c=[].concat(r.options.magnifiers,r.options.regions,r.options.colors,r.options.speech,r.options.sound,r.options.explorers);try{for(var s=o(c),u=s.next();!u.done;u=s.next()){var l=u.value,p=n[l];if(p){var h=p(t);a.push(h)}}}catch(t){e={error:t}}finally{try{u&&!u.done&&(i=s.return)&&i.call(s)}finally{if(e)throw e.error}}return a}}(e.ControllerFactory||(e.ControllerFactory={}))},172:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.MenuExplorer=e.KeyExplorer=e.AbstractExplorer=void 0;var i=n(446),a=n(807),c=function(t){function e(e){var n=t.call(this,e)||this;return n.container=e,n.setupControls(),n}return r(e,t),e.prototype.activate=function(){this.active&&(this.container.update(),this.addControls(),t.prototype.activate.call(this))},e.prototype.deactivate=function(){this.active&&(t.prototype.deactivate.call(this),this.removeControls())},e.prototype.addEvents=function(){this.active&&t.prototype.addEvents.call(this)},e.prototype.setupControls=function(){},e.prototype.addControls=function(){},e.prototype.removeControls=function(){},e.prototype.update=function(){},e.prototype.customEvents=function(){var t=this,e=this.container.molecule.node;new i.CustomEvent(e,i.EventType.KEYDOWN,(function(e){return t.active&&e.keyCode===i.KeyCodes.ESC&&t.container.deactivate(),t.container.active||e.keyCode===t.getActivationKey()&&(t.active=!0,t.container.activate(),e.preventDefault()),e.stopPropagation(),!1})).add()},e}(n(530).AbstractController);e.AbstractExplorer=c;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=a.explorers.KEY,e}return r(e,t),e.prototype.setupControls=function(){var t=this,e=function(e,n){var o=n();o.length>0&&t.container.update(o[0]),e.preventDefault()};this.registerEvent(this.container.molecule.node,i.EventType.KEYDOWN,(function(n){switch(n.keyCode){case i.KeyCodes.DOWN:case i.KeyCodes.D:e(n,(function(){return t.container.activeElement.getDown()}));break;case i.KeyCodes.UP:case i.KeyCodes.E:e(n,(function(){return t.container.activeElement.getUp()}));break;case i.KeyCodes.RIGHT:case i.KeyCodes.F:e(n,(function(){return t.container.activeElement.getRight()}));break;case i.KeyCodes.LEFT:case i.KeyCodes.S:e(n,(function(){return t.container.activeElement.getLeft()}))}return n.stopPropagation(),!1}))},e.prototype.getActivationKey=function(){return i.KeyCodes.A},e}(c);e.KeyExplorer=s;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=a.explorers.MENU,e}return r(e,t),e.prototype.setupControls=function(){var t=this,e=this.container.molecule.createElement("ul");e.classList.add("cacc-controls"),e.setAttribute("role","navigation"),this.control_=e;var n=function(e,n){var o=n();o.length>0&&t.container.update(o[0])},o=function(e,o){t.registerEvent(e,i.EventType.KEYDOWN,(function(t){return t.keyCode!==i.KeyCodes.ENTER&&t.keyCode!==i.KeyCodes.SPACE||(n(0,o),t.preventDefault(),t.stopPropagation()),!1})),t.registerEvent(e,i.EventType.CLICK,(function(t){return n(0,o),t.stopPropagation(),!1}))};o(this.makeButton_("Down",e),(function(){return t.container.activeElement.getDown()})),o(this.makeButton_("Up",e),(function(){return t.container.activeElement.getUp()})),o(this.makeButton_("Next",e),(function(){return t.container.activeElement.getRight()})),o(this.makeButton_("Previous",e),(function(){return t.container.activeElement.getLeft()}))},e.prototype.addControls=function(){var t=this.container.molecule.node,e=t.querySelector(".cacc-message");e?t.insertBefore(this.control_,e):t.appendChild(this.control_)},e.prototype.removeControls=function(){this.control_.parentNode.removeChild(this.control_)},e.prototype.getActivationKey=function(){return i.KeyCodes.B},e.prototype.makeButton_=function(t,e){var n=this.container.molecule.createElement("li");return n.setAttribute("role","button"),n.setAttribute("aria-controls",this.container.molecule.node.getAttribute("id")),n.classList.add("cacc-button"),n.setAttribute("tabindex","0"),n.setAttribute("title",t),n.appendChild(document.createTextNode(t)),e.appendChild(n),n},e}(c);e.MenuExplorer=u},10:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.StepMagnifier=e.SimpleMagnifier=e.DummyMagnifier=e.AbstractMagnifier=void 0;var i=n(446),a=n(807),c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),Object.defineProperty(e.prototype,"active",{get:function(){return this._active&&a.config.MAG_ACTIVE===this.name},set:function(t){this._active=t},enumerable:!1,configurable:!0}),e.prototype.update=function(){this.container.viewBox.select(this.container.activeElement.getDrawnElements())},e.prototype.deactivate=function(){this.active&&(this.container.viewBox.clearActive(),this.container.viewBox.reset(),t.prototype.deactivate.call(this))},e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,i.EventType.KEYDOWN,(function(e){return e.keyCode===t.getActivationKey()&&a.config.MAG_ACTIVE!==t.name&&(a.config.MAG_ACTIVE=t.name,t.update()),e.stopPropagation(),!1}))},e}(n(530).AbstractController);e.AbstractMagnifier=c;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=a.magnifiers.DUMMY,e}return r(e,t),e.prototype.getActivationKey=function(){return i.KeyCodes.N},e.prototype.update=function(){this.container.viewBox.reset(),t.prototype.update.call(this)},e}(c);e.DummyMagnifier=s;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=a.magnifiers.SIMPLE,e}return r(e,t),e.prototype.update=function(){this.container.viewBox.select(this.container.activeElement.getDrawnElements()),this.container.viewBox.zoom("cacc-active")},e.prototype.getActivationKey=function(){return i.KeyCodes.COMMA},e}(c);e.SimpleMagnifier=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=a.magnifiers.STEP,e.lastActive=null,e}return r(e,t),e.prototype.update=function(){var t=this.container.activeElement,e=this.container.viewBox,n=this.lastActive?this.lastActive.getDrawnElements():[];this.container.viewBox.select(t.getDrawnElements(),"cacc-almost"),e.select(t.getDrawnElements().concat(n),"cacc-dummy"),this.lastActive=t,e.zoom("cacc-dummy",{duration:250,delay:25,wait:300,callback:function(){e.select([],"cacc-almost"),e.select(t.getDrawnElements(),"cacc-active"),e.zoom("cacc-active",{duration:250,delay:25,wait:300})}})},e.prototype.getActivationKey=function(){return i.KeyCodes.M},e}(c);e.StepMagnifier=l},556:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Speech=e.Subtitle=e.LiveRegion=void 0;var i=n(422),a=n(911),c=n(446),s=n(807),u=function(t){function e(e){var n=t.call(this,e)||this;return n.container=e,n.setupMessage(),n}return r(e,t),e.prototype.setupMessage=function(){var t=this.container.molecule.createElement("p");t.classList.add("explorer"),t.setAttribute("aria-live","assertive"),i.hasSpeech()&&(speechSynthesis.onvoiceschanged=function(){speechSynthesis.getVoices().length&&t.removeAttribute("aria-live")}),t.setAttribute("tabindex","-1"),t.classList.add("cacc-message"),this.message=t},e.prototype.activate=function(){this.active||(this.addMessage(),t.prototype.activate.call(this))},e.prototype.deactivate=function(){this.active&&(t.prototype.deactivate.call(this),this.removeMessage())},e.prototype.removeMessage=function(){this.message.parentNode.removeChild(this.message)},e.prototype.update=function(){this.message.textContent=this.container.activeElement.getSpeech()},e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,c.EventType.KEYDOWN,(function(e){return e.keyCode===c.KeyCodes.Z&&(t.toggleMessageVisibility(),s.config.MSG_VISIBLE=!s.config.MSG_VISIBLE),e.stopPropagation(),!1}))},e.prototype.toggleMessageVisibility=function(){a.toggleTextVisibility(this.message)},e}(n(530).AbstractController);e.LiveRegion=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=s.regions.SUBTITLE,e}return r(e,t),e.prototype.addMessage=function(){this.container.molecule.node.parentNode.appendChild(this.message),s.config.MSG_VISIBLE||this.message.classList.add("cacc-text-invisible")},e}(u);e.Subtitle=l;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=s.regions.SPEECH,e}return r(e,t),e.prototype.setupMessage=function(){this.message=s.config.SUBTITLE},e.prototype.addMessage=function(){this.message.parentNode||i.getDocument().body.appendChild(this.message)},e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,c.EventType.KEYDOWN,(function(e){return e.keyCode===c.KeyCodes.V&&(t.toggleMessageVisibility(),s.config.SUB_VISIBLE=!s.config.SUB_VISIBLE),e.stopPropagation(),!1}))},e}(u);e.Speech=p},150:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Voicing=e.Oscillator=e.AbstractSoundController=void 0;var i=n(422),a=n(446),c=n(807),s=n(530),u=n(394),l=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.activate=function(){t.prototype.activate.call(this),this.active=this.on()},e.prototype.deactivate=function(){this.stop(),t.prototype.deactivate.call(this)},e.prototype.update=function(){this.stop()},e.prototype.getStopKey=function(){return a.KeyCodes.K},e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,a.EventType.KEYDOWN,(function(e){return e.keyCode===t.getActivationKey()&&(t.active=!t.active,t.toggle(t.active),t.active?t.update():t.stop()),e.keyCode===t.getRepeatKey()&&t.update(),e.keyCode===t.getStopKey()&&t.stop(),e.stopPropagation(),!1}))},e}(s.AbstractController);e.AbstractSoundController=l;var p=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.sound.OSCILLATOR,e.currentOscillators=[],e}return r(e,t),e.prototype.update=function(){t.prototype.update.call(this),this.currentOscillators=u.Sonify.sonify(this.container.activeElement)},e.prototype.on=function(){return c.config.SONIFY},e.prototype.toggle=function(t){c.config.SONIFY=t},e.prototype.stop=function(){this.currentOscillators.forEach((function(t){return t.stop()}))},e.prototype.getActivationKey=function(){return a.KeyCodes.O},e.prototype.getRepeatKey=function(){return a.KeyCodes.P},e}(l);e.Oscillator=p;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.sound.VOICING,e.languages=null,e}return r(e,t),e.prototype.update=function(){t.prototype.update.call(this);var e=new SpeechSynthesisUtterance(this.container.activeElement.getSpeech());e.lang=this.languages?this.languages.active:c.config.VOICE_LANG,speechSynthesis.speak(e)},e.prototype.activate=function(){i.hasSpeech()&&(this.languages=this.container.molecule.cmlStructure.getRootElement().getDiagram().languages,this.languages&&this.languages.updateActive(),t.prototype.activate.call(this))},e.prototype.getActivationKey=function(){return a.KeyCodes.Y},e.prototype.getRepeatKey=function(){return a.KeyCodes.U},e.prototype.on=function(){return c.config.VOICING},e.prototype.toggle=function(t){c.config.VOICING=t},e.prototype.stop=function(){i.hasSpeech()&&speechSynthesis.cancel()},e}(l);e.Voicing=h},916:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Language=e.Expert=e.AbstractSpeech=void 0;var i=n(422),a=n(446),c=n(807),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.update=function(){},e}(n(530).AbstractController);e.AbstractSpeech=s;var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.speech.EXPERT,e}return r(e,t),e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,a.EventType.KEYDOWN,(function(e){return e.keyCode===a.KeyCodes.X&&(i.toggleExpertMode(),t.container.update()),e.stopPropagation(),!1}))},e}(s);e.Expert=u;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name=c.speech.LANGUAGE,e}return r(e,t),e.prototype.customEvents=function(){var t=this;this.registerEvent(this.container.molecule.node,a.EventType.KEYDOWN,(function(e){e.keyCode===a.KeyCodes.L&&(t.container.molecule.cmlStructure.getMap().nextLanguage()&&t.container.active&&t.container.update());return e.stopPropagation(),!1}))},e}(s);e.Language=l},250:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Bbox=void 0;var n=function(){function t(t,e,n,o){this.x=t,this.y=e,this.width=n,this.height=o}return t.fromSvgRect=function(e){return new t(e.x,e.y,e.width,e.height)},t.fromSvgViewBox=function(e){return new t(e.baseVal.x,e.baseVal.y,e.baseVal.width,e.baseVal.height)},t.combineBboxes=function(e){var n=function(t){var e=t.getBBox();if(0===e.x&&0===e.y&&0===e.width&&0===e.height&&t.childNodes&&t.childNodes[0]&&t.childNodes[0].transform){var n=t.childNodes[0],o=void 0,r=void 0,i=void 0,a=void 0;if(n.x&&n.y&&n.width&&n.height)o=n.x.baseVal.value,r=n.y.baseVal.value,i=n.width.baseVal.value,a=n.height.baseVal.value;else{var c=n.getBBox();o=c.baseVal.x,r=c.baseVal.y,i=c.baseVal.width,a=c.baseVal.height}var s=t.ownerSVGElement.createSVGPoint(),u=n.transform.baseVal;s.x=o,s.y=r;for(var l=u.length-1;l>=0;l--)s=s.matrixTransform(u.getItem(l).matrix);e.x=s.x,e.y=s.y,e.width=i,e.height=a}return e},o=t.fromSvgRect(n(e[0]));return 1===e.length?o:e.slice(1).reduce((function(t,e){return t.combine(n(e))}),o)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.width+e.width,this.height+e.height)},t.prototype.difference=function(t,e,n){var o=this.add(t.scale(-1));return e&&(o.x=o.x-e/2,o.width=o.width+e),n&&(o.y=o.y-n/2,o.height=o.height+n),o},t.prototype.scale=function(e){return new t(this.x*e,this.y*e,this.width*e,this.height*e)},t.prototype.combine=function(e){var n=Math.min(this.x,e.x),o=Math.min(this.y,e.y);return new t(n,o,Math.max(this.x+this.width,e.x+e.width)-n,Math.max(this.y+this.height,e.y+e.height)-o)},t.prototype.viewBoxValue=function(){return this.x+" "+this.y+" "+this.width+" "+this.height},t}();e.Bbox=n},966:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(r,i){function a(t){try{s(o.next(t))}catch(t){i(t)}}function c(t){try{s(o.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((o=o.apply(t,e||[])).next())}))},a=this&&this.__generator||function(t,e){var n,o,r,i,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function c(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,o&&(r=2&i[0]?o.return:i[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,i[1])).done)return r;switch(o=0,r&&(i=[2&i[0],r.value]),i[0]){case 0:case 1:r=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,o=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!r||i[1]>r[0]&&i[1]<r[3])){a.label=i[1];break}if(6===i[0]&&a.label<r[1]){a.label=r[1],r=i;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(i);break}r[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],o=0}finally{n=r=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var c=n(911),s=n(446),u=n(807),l=n(530),p=n(889),h=n(691),f=n(229),d=function(t){function e(e,n){var o=t.call(this,null)||this;return o.key=e,o.mol=n,o.name="Container",o.controllers=[],o.initElement().then((function(){o.viewBox=new f.ViewBox(o.molecule.svg),o.controllers=o.controllers.concat(p.ControllerFactory.get(o)),c.moleculeStyle(o.molecule),o.activeElement=o.molecule.cmlStructure.getRootElement(),o.customEvents(),o.getDefaultExplorer()})).catch((function(){console.error("Failed to initialize element "+e)})),o}return r(e,t),e.loadElement=function(t){return i(this,void 0,void 0,(function(){var e;return a(this,(function(n){return e=0,[2,new Promise((function(n,o){var r=function(){t.hasAttribute("has-svg")&&t.hasAttribute("has-cml")?n():e>5?o(t):(e++,setTimeout(r,100))};r()})).catch((function(t){"true"!==t.getAttribute("has-svg")&&console.error("Failed to load SVG diagram."),"true"!==t.getAttribute("has-cml")&&console.error("Failed to load XML annotation.")}))]}))}))},e.prototype.initElement=function(){return i(this,void 0,void 0,(function(){var t=this;return a(this,(function(n){return[2,e.loadElement(this.mol).then((function(){if("true"!==t.mol.getAttribute("has-svg")||"true"!==t.mol.getAttribute("has-cml"))return Promise.reject("Loading of components failed.");var e=t.mol.querySelector("div.svg").children[0],n=t.mol.querySelector("div.cml").children[0];return e&&n?(t.mol.setAttribute("tabindex","0"),t.mol.setAttribute("role","application"),e.setAttribute("aria-hidden","true"),n.setAttribute("aria-hidden","true"),t.mol.hasAttribute("aria-label")||t.mol.setAttribute("aria-label","Navigatable "+n.tagName),t.molecule=new h.Molecule(t.mol,e,n),Promise.resolve()):Promise.reject("Empty Diagram elements.")})).catch((function(t){console.error("Molecule Structure initialisation failed with:",t)}))]}))}))},e.prototype.update=function(t){t&&(this.activeElement=t),this.controllers.forEach((function(t){t.active&&t.update()}))},e.prototype.activate=function(){t.prototype.activate.call(this),this.controllers.forEach((function(t){return t.activate()}))},e.prototype.deactivate=function(){this.controllers.forEach((function(t){return t.deactivate()})),t.prototype.deactivate.call(this)},e.prototype.customEvents=function(){var t,e=this;(null===(t=this.molecule)||void 0===t?void 0:t.node)&&(this.registerEvent(this.molecule.node,s.EventType.KEYDOWN,(function(t){return t.keyCode===s.KeyCodes.SPACE&&(e.update(),t.preventDefault(),t.stopPropagation()),!1})),new s.CustomEvent(this.molecule.node,s.EventType.KEYDOWN,(function(t){return e.defaultExplorer&&!e.active&&t.keyCode===s.KeyCodes.ENTER&&(e.defaultExplorer.active=!0,e.activate(),t.preventDefault(),t.stopPropagation()),!1})).add(),new s.CustomEvent(this.molecule.node,s.EventType.CLICK,(function(t){return e.defaultExplorer&&!e.active&&(e.defaultExplorer.active=!0,e.activate(),t.stopPropagation()),!1})).add())},e.prototype.getDefaultExplorer=function(){this.defaultExplorer=this.controllers.find((function(t){return t.name===u.explorers.KEY})),this.defaultExplorer||(this.defaultExplorer=this.controllers.find((function(t){return t.name===u.explorers.MENU})))},e}(l.AbstractController);e.Container=d},88:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Diagram=void 0;var n=function(){function t(t){this.languages=t,this.diagram_={}}return t.prototype.set=function(t,e){this.diagram_[t]=e},t.prototype.get=function(t){return this.diagram_[t]},t.prototype.forEach=function(t){for(var e in this.diagram_)t.call(this,this.diagram_[e])},t.prototype.find=function(t){for(var e in this.diagram_){var n=this.diagram_[e];if(t.call(this,n))return n}return null},t.prototype.translate=function(t){return this.languages?this.languages.translate(t):t},t.prototype.nextLanguage=function(){return this.languages?(this.languages.nextLanguage(),this.languages.active):null},t}();e.Diagram=n},465:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Language=void 0;var o=n(422),r=function(){function t(t){this.cmlDocument=t,this.messages={},this.language=this.getLanguage(),this.insertMessages()}return t.prototype.getLanguage=function(){var t=this.cmlDocument.querySelector("language");return t?t.textContent:""},t.prototype.insertMessages=function(){for(var t=this.cmlDocument.querySelectorAll("message"),e=0,n=void 0;n=t[e];e++)this.messages[o.getAttribute(n,"msg")]=n.textContent},t.prototype.translate=function(t){return this.messages[t]},t}();e.Language=r},495:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Languages=void 0;var o=n(807),r=n(465),i=function(){function t(t){this.cmlDocument=t,this.languages={},this.insertLanguages(),this.active=this.defaultActive()}return t.createLanguages=function(e){return 0===Array.from(e.querySelectorAll("messages")).filter((function(t){return t.childNodes.length})).length?null:new t(e)},t.prototype.insertLanguages=function(){for(var t=this.cmlDocument.querySelectorAll("messages"),e=0,n=void 0;n=t[e];e++){var o=n.querySelector("language");o&&(this.languages[o.textContent]=new r.Language(n))}},t.prototype.updateActive=function(){this.active=this.languages[o.config.ACTIVE_LANG]?o.config.ACTIVE_LANG:this.defaultActive()},t.prototype.defaultActive=function(){return this.languages[o.config.VOICE_LANG]?o.config.VOICE_LANG:Object.keys(this.languages)[0]},t.prototype.translate=function(t){return this.languages[this.active].translate(t)},t.prototype.nextLanguage=function(){var t=Object.keys(this.languages),e=t.indexOf(this.active)+1;this.active=t.length>e?t[e]:t[0],o.config.ACTIVE_LANG=this.active},t}();e.Languages=i},229:function(t,e,n){var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},r=this&&this.__read||function(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,r,i=n.call(t),a=[];try{for(;(void 0===e||e-- >0)&&!(o=i.next()).done;)a.push(o.value)}catch(t){r={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(r)throw r.error}}return a};Object.defineProperty(e,"__esModule",{value:!0}),e.ViewBox=e.ZoomOptions=void 0;var i=n(422),a=n(250),c=function(){};e.ZoomOptions=c;var s=function(){function t(t){this.svg=t,this.focusgroups=new Map,this.defaultZoomOptions={xPad:this.svg.width.baseVal.value/5,yPad:this.svg.height.baseVal.value/5,duration:100,delay:10,wait:0,callback:function(){}},this.reset()}return t.prototype.reset=function(){this.setViewBox_(a.Bbox.fromSvgRect(this.svg.getBBox()))},t.prototype.setClass=function(t,e){for(var n=0;n<t.length;n++)i.classList.add(t[n],e)},t.prototype.clearClass=function(t,e){for(var n=0;n<t.length;n++)i.classList.remove(t[n],e)},t.prototype.clearActive=function(){var t,e;try{for(var n=o(this.focusgroups),i=n.next();!i.done;i=n.next()){var a=r(i.value,2),c=a[0],s=a[1];this.clearClass(s,c)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.focusgroups.clear()},t.prototype.select=function(t,e){var n=e||"cacc-active",o=this.focusgroups.get(n);o&&this.clearClass(o,n),this.setClass(t,n),this.focusgroups.set(n,t)},t.prototype.zoom=function(t,e){var n=this.focusgroups.get(t);n&&0!==n.length&&this.setViewBox_(a.Bbox.combineBboxes(n),e)},t.prototype.setViewBox_=function(t,e){for(var n=this,o=this.completeZoomOptions_(e),r=this.retrieveViewBox_(),i=t.difference(r,o.xPad,o.yPad),a=Math.ceil(o.duration/o.delay),c=i.scale(1/a),s=function(t){return function(){return n.svg.setAttribute("viewBox",r.add(c.scale(t)).viewBoxValue())}},u=1;u<=a;u++)setTimeout(s(u),u*o.delay);o.callback&&setTimeout(o.callback,o.wait+o.duration)},t.prototype.completeZoomOptions_=function(t){return t?Object.assign({},this.defaultZoomOptions,t):this.defaultZoomOptions},t.prototype.retrieveViewBox_=function(){try{return a.Bbox.fromSvgViewBox(this.svg.viewBox)}catch(t){return new a.Bbox(0,0,0,0)}},t}();e.ViewBox=s},839:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}),i=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.Atom=void 0;var a=n(422),c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.speech="",e}return r(e,t),e.prototype.getSpeech=function(){if(this.link){var t=this.getUpperNeighbour_(),e=t?t.getSpeech():"",n=[];return this.neighbourhood.forEach((function(t){"external"!==t.location&&n.push(t.getSpeech())})),this.speech=e+" "+n.join(" "),this.speech}var o=this.neighbourhood.map((function(t){return t.getSpeech()})).join(" "),r=this.getMessage();return this.speech=this.getDiagram().translate(r)+" "+o,this.speech},e.prototype.getDrawnElements=function(){if(this.drawnElements)return this.drawnElements;this.drawnElements=[];var t=this.getDrawnElement();t&&this.drawnElements.push(t);for(var e=this.getAnnotation().querySelectorAll("component *"),n=0;n<e.length;n++){(t=this.getDiagram().get(a.getTextContent(e[n])).getDrawnElement())&&-1===this.drawnElements.indexOf(t)&&this.drawnElements.push(t)}return this.drawnElements},e.prototype.getUpperNeighbour_=function(){var t,e;try{for(var n=i(this.up.neighbourhood),o=n.next();!o.done;o=n.next()){var r=o.value;if(-1!==r.via().map((function(t){return t.getPosition()})).indexOf(this.position))return r}}catch(e){t={error:e}}finally{try{o&&!o.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}return null},e}(n(41).NeighbourHood);e.Atom=c},111:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.AtomSet=void 0;var i=n(422),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return r(e,t),e.prototype.getDrawnElements=function(){var t=this;if(this.drawnElements)return this.drawnElements;this.drawnElements=[];var e={},n=function(n){e[n.id]||(e[n.id]=!0,t.drawnElements.push(n))},o=this.getDrawnElement();o&&n(o);for(var r=0,a=void 0;a=this.getDown()[r];r++)a.getDrawnElements().forEach(n),(o=a.getDrawnElement())&&n(o);var c=this.getAnnotation().querySelectorAll("component bond,passive");for(r=0;r<c.length;r++){var s=i.getTextContent(c[r]);(a=this.getDiagram().get(s)).getDrawnElements().forEach(n),(o=a.getDrawnElement())&&n(o)}return this.drawnElements},e}(n(41).NeighbourHood);e.AtomSet=a},202:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.Bond=void 0;var i=n(422),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ends=[],e}return r(e,t),e.prototype.complete=function(){for(var t=this.getAnnotation().querySelectorAll("component > atom,active"),e=0,n=void 0;n=t[e];e++){var o=this.getDiagram().get(i.getTextContent(n));o&&this.ends.push(o)}},e}(n(41).NeighbourHood);e.Bond=a},903:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.ChemObj=void 0;var o=n(422),r=function(){function t(t,e){this.annotation_=t,this.diagram_=e,this.drawnElements=null,this.up=null,this.down=[],this.link=!1,this.drawn_=null,this.id_=this.getId_(),this.parent_=this.getParent_(),this.position=this.getPosition_()}return t.prototype.getAnnotation=function(){return this.annotation_},t.prototype.getDiagram=function(){return this.diagram_},t.prototype.getId=function(){return this.id_},t.prototype.setDrawnElement=function(t){this.drawn_=t},t.prototype.getDrawnElement=function(){return this.drawn_},t.prototype.getDrawnElements=function(){return this.drawnElements||(this.drawnElements=[],this.drawn_&&this.drawnElements.push(this.drawn_)),this.drawnElements},t.prototype.complete=function(){if(this.down.length&&this.down.sort((function(t,e){return!t.position&&e.position?1:t.position-e.position})),this.parent_){var t=this.getDiagram().get(this.parent_);this.up=t,t.down.push(this)}},t.prototype.getParent=function(){return this.parent_},t.prototype.getKey=function(){return this.id_+this.parent_},t.prototype.getUp=function(){return this.up?[this.up]:[]},t.prototype.getDown=function(){return this.down},t.prototype.getRight=function(){if(!this.up)return[];var t=this.up.getDown(),e=t.indexOf(this);if(t.length>e+1){var n=t[e+1];return n.position?[n]:[]}return[]},t.prototype.getLeft=function(){if(!this.up)return[];var t=this.up.getDown(),e=t.indexOf(this);if(e>0){var n=t[e-1];return n.position?[n]:[]}return[]},t.prototype.getId_=function(){var t=this.getAnnotation().firstElementChild;return t?t.textContent:""},t.prototype.getParent_=function(){var t=this.getAnnotation().querySelector("parents > *");return t?o.getTextContent(t):""},t.prototype.getPosition_=function(){return parseInt(o.getTextContent(this.getAnnotation().querySelector("position")),10)},t}();e.ChemObj=r},183:function(t,e,n){var o=this&&this.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],o=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&o>=t.length&&(t=void 0),{value:t&&t[o++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};Object.defineProperty(e,"__esModule",{value:!0}),e.CML=void 0;var r=n(88),i=n(495),a=n(839),c=n(111),s=n(202),u=function(){function t(t){this.cmlDocument=t,this.root=null,this.map=new r.Diagram(i.Languages.createLanguages(t)),this.initMap_()}return t.prototype.getMap=function(){return this.map},t.prototype.getRootElement=function(){return this.root||(this.root=this.map.find((function(t){return!(t instanceof s.Bond||t.up)}))),this.root},t.prototype.initMap_=function(){var t,e,n=Array.from(this.cmlDocument.querySelectorAll("annotations > annotation"));try{for(var r=o(n),i=r.next();!i.done;i=r.next()){var u=i.value,l=u.firstElementChild;if(l){var p=void 0;switch(l.localName.toLowerCase()){case"atom":case"active":p=new a.Atom(u,this.map),this.map.set(p.getKey(),p);break;case"bond":case"passive":p=new s.Bond(u,this.map),this.map.set(p.getId(),p);break;case"atomset":case"grouped":p=new c.AtomSet(u,this.map),this.map.set(p.getId(),p)}}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}this.map.forEach((function(t){return t.complete()}))},t}();e.CML=u},691:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Molecule=void 0;var o=n(422),r=n(183),i=function(){function t(t,e,n){this.node=t,this.svg=e,this.cml=n,this.id=o.getId(),o.classList.add(this.svg,this.id),o.classList.add(this.cml,this.id),this.cmlStructure=new r.CML(this.cml),this.topLevelDescription=this.cmlStructure.getRootElement().getSpeech(),this.combine_()}return t.prototype.createElement=function(t){var e=document.createElement(t);return e.classList.add(this.id),e},t.prototype.combine_=function(){var t=this;this.cmlStructure.getMap().forEach((function(e){var n=t.svg.getElementById(e.getId());n&&e.setDrawnElement(n)}))},t}();e.Molecule=i},171:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Neighbour=void 0;var o=n(422),r=n(122),i=function(){function t(t,e){var n=this;this.from_=t,this.annotation_=e,this.speech=null,this.speech2=null;var i=o.children(this.annotation_);this.to_=this.from_.getDiagram().get(o.getTextContent(i[0])),this.via_=i.slice(1).map((function(t){return new r.Via(n,t)})),this.location=this.annotation_.getAttribute("sre:location")||""}return t.prototype.from=function(){return this.from_},t.prototype.to=function(){return this.to_},t.prototype.via=function(){return this.via_},t.prototype.getSpeech=function(){return this.from_.getDiagram().translate(this.getMessage())},t.prototype.getMessage=function(){if(o.EXPERT_MODE){if(this.speech2)return this.speech2;if(this.speech2=o.getAttribute(this.annotation_,"speech2"),this.speech2)return this.speech2}return this.speech||(this.speech=o.getAttribute(this.annotation_,"speech")),this.speech},t}();e.Neighbour=i},41:function(t,e,n){var o,r=this&&this.__extends||(o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)},function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});Object.defineProperty(e,"__esModule",{value:!0}),e.NeighbourHood=void 0;var i=n(422),a=n(903),c=n(171),s=function(t){function e(e,n){var o=t.call(this,e,n)||this;return o.neighbourhood=[],o}return r(e,t),e.prototype.complete=function(){t.prototype.complete.call(this);for(var e=this.getAnnotation().querySelectorAll("neighbours neighbour"),n=0,o=void 0;o=e[n];n++)this.neighbourhood.push(new c.Neighbour(this,o))},e.prototype.getSpeech=function(){return this.getDiagram().translate(this.getMessage())},e.prototype.getMessage=function(){if(i.EXPERT_MODE){var t=i.getAttribute(this.getAnnotation(),"speech2");if(t)return t}return i.getAttribute(this.getAnnotation(),"speech")},e.prototype.getNeighbours=function(){return this.neighbourhood},e}(a.ChemObj);e.NeighbourHood=s},122:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Via=void 0;var o=n(422),r=function(){function t(t,e){this.neighbour_=t,this.annotation_=e,this.type_=o.getAttribute(this.annotation_,"type");var n=o.children(this.annotation_);this.connectedBy_=this.getConnectedBy_(n[0]),void 0!==this.connectedBy_&&(this.connectedBy_.link=!0),this.position_=parseInt(o.getTextContent(n[1]),10)}return t.prototype.getDrawnElements=function(){return this.connectedBy_.getDrawnElements()||[]},t.prototype.getType=function(){return this.type_||""},t.prototype.getPosition=function(){return this.position_},t.prototype.getConnectedBy_=function(t){var e=this.neighbour_.from().getDiagram(),n=o.getTextContent(t),r=e.get(n);return r||e.get(n+this.neighbour_.from().getId())},t}();e.Via=r},394:(t,e,n)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.Sonify=void 0;var o=n(422),r=function(){function t(t){this.path=[],this.points=[],this.context=new AudioContext,this.prepare(t),this.sonifiable=this.path.length}return t.sonify=function(e){var n=e.getAnnotation().querySelectorAll("sonification > *"),r=[];n.length&&(r=Array.from(n).map((function(t){var n=o.getTextContent(t),r=n+("ACTIVE"!==t.tagName&&"sre:active"!==t.tagName?"":n===e.getId()?e.getParent():e.getId());return e.getDiagram().get(r)})));var i=new t(r);return i.sonifiable?i.sonify():[]},t.prototype.prepare=function(t){for(var e=0,n=void 0;n=t[e];e++)if(n.getDrawnElement()){for(var o=n.getDrawnElement().querySelectorAll("polyline,path"),r=0;r<o.length;r++){var i=o[r];this.path.push(i);for(var a=0;a<i.points.length;a++)this.points.push([i.points[a].x,i.points[a].y])}o=n.getDrawnElement().querySelectorAll("rect");for(r=0;r<o.length;r++){i=o[r];this.path.push(i),this.points.push([i.x.animVal.value,i.height.animVal.value?i.y.animVal.value+i.height.animVal.value:0])}}},t.prototype.sonify=function(){for(var e=[],n=0;n<this.points.length;n++){var o=this.context.createOscillator();e.push(o),o.frequency.value=this.points[n][1]?t.BASE_FREQUENCY+10*this.points[n][1]:0,o.type="sine",o.connect(this.context.destination);var r=void 0,i=void 0;this.points.length>20?(r=n/10+.01,i=n/10+.1):(r=n/2+.01,i=n/2+.5),o.start(this.context.currentTime+r),o.stop(this.context.currentTime+i)}return e},t.prototype.smooth=function(){if(this.points.length){for(var e=[this.points[0]],n=0;n<this.points.length-1;n++){for(var o=this.points[n][0],r=this.points[n][1],i=this.points[n+1][0],a=this.points[n+1][1],c=Math.abs(o-i)/t.SMOOTH_VALUE,s=Math.abs(r-a)/t.SMOOTH_VALUE,u=Math.sign(a-r),l=1;l<t.SMOOTH_VALUE;l++)e.push([o+l*c,r+u*l*s]);e.push([i,a])}this.points=e}},t.BASE_FREQUENCY=300,t.SMOOTH_VALUE=4,t}();e.Sonify=r}},e={};function n(o){var r=e[o];if(void 0!==r)return r.exports;var i=e[o]={exports:{}};return t[o].call(i.exports,i,i.exports,n),i.exports}var o={};return(()=>{var t=o;Object.defineProperty(t,"__esModule",{value:!0}),t.Config=t.Base=void 0;var e=n(807),r=n(23);t.Base=r.Base,t.Config=e.config})(),o})()}));